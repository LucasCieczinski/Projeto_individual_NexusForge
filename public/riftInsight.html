<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - NexusForge</title>
  <link rel="stylesheet" href="Styles/style_dash.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <nav class="sidebar">
    <div class="logo">
      <img src="img/logo-dark.png" alt="Logo">
    </div>

    <ul>
      <li><a href="#"><i class="fa-solid fa-chart-line"></i><span>Desempenho</span></a></li>
      <li><a href="#"><i class="fa-solid fa-clipboard-list"></i><span>Missões</span></a></li>
      <li><a href="config.html"><i class="fa-solid fa-gear"></i><span>Configurações</span></a></li>
      <li><a href="#"><i class="fa-solid fa-right-from-bracket"></i><span>Sair</span></a></li>
    </ul>
  </nav>

  <main class="main-content">
    <header class="header">
      <h1>Bem-vindo à sua Dashboard, user</h1>
      <div class="user">
        <i class="fa-solid fa-user"></i>
        <span>user</span>
      </div>
    </header>

    <section class="player-card">
      <button onclick="obterDados()">Obter</button>
      <div class="card-frame">
        <div class="fundo"></div>
        <div class="info-topo">
          <span class="player-rating">88</span>
          <h2 class="player-name">INVOKERX</h2>
        </div>
        <div class="info-baixo">
          <div class="details">
            <p><strong>Campeão:</strong> Ahri</p>
            <p><strong>KDA Médio:</strong> 3.2</p>
            <p><strong>Taxa de Vitória:</strong> 62%</p>
          </div>
        </div>
      </div>
      <div class="grafico-box" style="position: relative; height:400px; width: 400px;">
        <canvas id="player-status"></canvas>
      </div>
    </section>

    <section>
      <div id="resultado">

      </div>
    </section>

  </main>
  <script src="radar.JS"></script>
</body>

</html>
<script>
  async function obterDados() {
    // Dados necessarios: 
    // idRiot .OK
    // Icone do Jogador e o id do Icone .OK
    // Dados das ultimas 20 partidas:
    // Vitoria ou derrota (Boolean)
    // CS da partida
    // Dano por minuto
    // Objetivos feitos
    // Gold por minuto
    // Placar de visão
    // KDA
    // Duração de partida???
    const riotAccount = 'AhriCatólica'
    const riotId = 'AMÉM'
    const apiKey = 'RGAPI-4f7be27c-2684-44d0-a5b6-48ff62021959';
    const region = 'br1';

    try {


      // Adquiri o nome e tag do usuario
      const contaResponse = await fetch(
        `https://americas.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${riotAccount}/${riotId}?api_key=${apiKey}`
      );
      if (!contaResponse.ok) throw new Error("Conta não encontrada");
      const conta = await contaResponse.json();


      // Adquiri o puuid
      const summonerResponse = await fetch(
        `https://br1.api.riotgames.com/lol/summoner/v4/summoners/by-puuid/${conta.puuid}?api_key=${apiKey}`
      );
      if (!summonerResponse.ok)
        throw new Error("Jogador não encontrado no LoL");
      const summoner = await summonerResponse.json();


      // Adquiri a versão da datadragon (API imgs) e insere o icone no card
      const iconResponse = await fetch(
        "https://ddragon.leagueoflegends.com/api/versions.json"
      );
      if (!iconResponse.ok)
        throw new Error("Versões não encontradas");
      const versions = await iconResponse.json();
      var iconUser = `https://ddragon.leagueoflegends.com/cdn/${versions[0]}/img/profileicon/${summoner.profileIconId}.png`
      const fundo = document.querySelector(".fundo");
      fundo.style.backgroundImage = `url("${iconUser}"), linear-gradient(135deg, #6a00ff, #d400ff, #ff0080)`;
      console.log(iconUser);



      // Adquiri o id das ultimas 20 partidas solo/duo
      const partidaResponse = await fetch(
        `https://americas.api.riotgames.com/lol/match/v5/matches/by-puuid/${conta.puuid}/ids?type=ranked&queue=420&count=20&api_key=${apiKey}`
      );
      if (!partidaResponse.ok)
        throw new Error("Nenhuma partida encontrada");
      const partida = await partidaResponse.json();

      // a posição [0] é sempre a mais recente
      var partida1 = partida[0];
      console.log(partida1)

      // Adquiri os dados das partidas
      const dadosResponse = await fetch(
        `https://americas.api.riotgames.com/lol/match/v5/matches/${partida1}?api_key=${apiKey}`
      );
      if (!dadosResponse.ok)
        throw new Error("Não foi possivel adquirir os dados das partidas");
      const dados = await dadosResponse.json();
      console.log(dados)

      // Variavel dos dados que serão usados
      


      // Duvidas :
      // 1 - Quando faço um fetch e recebo um arquivo JSON, enquanto a seção/codigo estiver rodando posso acessar aquele JSON sem fazer a requisição novamente?
      // 2 - Devo criar uma variavel para cada dado que irei usar? ou devo criar um array?
      // 3 - Devo fazer a função ser chamada assim que o usuario realizar o Login? Lembrando, quero que a tela de login tenha um delay de 3seg para redirecionar para a Dash, (Com o objetivo de melhorar o desempenho e velocidade de resposta)



      resultado.innerHTML = `
        <p><strong>Nome:</strong> ${summoner.name ?? conta.gameName}</p>
        <p><strong>Icone:</strong> ${summoner.profileIconId}</p>
        <p><strong>Nível:</strong> ${summoner.summonerLevel}</p>
        <p><strong>PUUID:</strong> ${conta.puuid}</p>
        <p><strong>${partida.length}</strong></p>
        <p><strong>Resultado:</strong> ${dados.endOfGameResult}</p>
        ${dados.info.gameVersion}
        ${dados.info.participants[0].championName}
      `;
      resultado.style.color = "lightgreen";
    } catch (err) {
      resultado.textContent = "Erro: " + err.message;
      resultado.style.color = "red";
    }
  }
</script>